<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ | Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø¨Ø¯Ø±ÙŠØ© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</title>
<style>
:root{
  --bg:#f9fafb;
  --card:#ffffff;
  --stroke:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
  --accent:#2563eb;
  --good:#16a34a;
  --bad:#dc2626;
  --shadow:0 10px 25px rgba(0,0,0,.08);
  --r:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Tajawal","Cairo",system-ui,Arial,sans-serif;color:var(--text);background:var(--bg);min-height:100vh}
header{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-bottom:1px solid var(--stroke)}
.topbar{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg, rgba(37,99,235,.95), rgba(22,163,74,.75));border:1px solid rgba(0,0,0,.06);box-shadow:0 10px 22px rgba(37,99,235,.12)}
h1{margin:0;font-size:15px}
.sub{color:#1f2937;font-size:12px;margin-top:6px;font-weight:700}
.sub span{color:var(--accent)}
.right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.pill{border:1px solid var(--stroke);background:#fff;border-radius:999px;padding:10px 12px;font-size:12px;color:var(--muted)}
.pill b{color:var(--text)}
.btn{border:1px solid var(--stroke);background:#fff;color:var(--text);padding:10px 12px;border-radius:999px;cursor:pointer;font-weight:800;font-size:12px}
.btn.primary{background:linear-gradient(135deg, rgba(37,99,235,.95), rgba(37,99,235,.70));border-color:rgba(37,99,235,.25);color:#fff}
.btn.good{background:linear-gradient(135deg, rgba(22,163,74,.95), rgba(22,163,74,.70));border-color:rgba(22,163,74,.25);color:#fff}
.btn.bad{background:linear-gradient(135deg, rgba(220,38,38,.95), rgba(220,38,38,.70));border-color:rgba(220,38,38,.25);color:#fff}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
.grid{display:grid;grid-template-columns:360px 1fr;gap:14px;margin-top:14px}
@media (max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid var(--stroke);border-radius:var(--r);box-shadow:var(--shadow);overflow:hidden}
.hd{padding:14px 16px;border-bottom:1px solid var(--stroke);display:flex;align-items:center;justify-content:space-between;gap:10px}
.bd{padding:16px}
label{display:block;color:var(--muted);font-size:12px;margin:10px 0 6px}
input,select{width:100%;padding:12px 12px;border-radius:14px;border:1px solid var(--stroke);background:#fff;color:var(--text);outline:none}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:520px){.row{grid-template-columns:1fr}}
.story{border:1px dashed #d1d5db;background:#f8fafc;border-radius:16px;padding:14px;line-height:1.9;white-space:pre-wrap}
.q{margin-top:12px;border:1px solid var(--stroke);background:#fff;border-radius:16px;padding:14px}
.q h3{margin:0 0 10px;font-size:13px}
.opt{display:flex;gap:10px;align-items:flex-start;padding:10px 12px;border-radius:14px;border:1px solid #e5e7eb;background:#f9fafb;cursor:pointer}
.opt:hover{border-color:#cbd5e1}
.opt.good{border-color:rgba(22,163,74,.45);background:rgba(22,163,74,.10)}
.opt.bad{border-color:rgba(220,38,38,.45);background:rgba(220,38,38,.10)}
.bullet{width:22px;height:22px;border-radius:999px;border:1px solid #cbd5e1;display:grid;place-items:center;font-weight:900;font-size:12px;margin-top:2px}
.muted{color:var(--muted)}
.toast{position:fixed;right:16px;bottom:16px;z-index:50;display:none;max-width:min(420px, calc(100vw - 32px));
  padding:12px 14px;border-radius:16px;border:1px solid var(--stroke);background:#fff;box-shadow:var(--shadow)}
.toast.show{display:block}
.overlay{position:fixed;inset:0;display:none;place-items:center;z-index:80;background:rgba(0,0,0,.35)}
.overlay.show{display:grid}
.celebrate{width:min(520px, calc(100vw - 32px));border-radius:22px;background:#fff;box-shadow:var(--shadow);padding:18px;text-align:center}
.celebrate h2{margin:0 0 8px;font-size:18px}
.celebrate p{margin:0 0 12px;color:var(--muted);line-height:1.8}
footer{text-align:center;margin:28px 0 12px;font-size:13px;color:var(--muted)}
canvas#confetti{position:fixed;inset:0;z-index:79;pointer-events:none;display:none}
canvas#confetti.show{display:block}
</style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</h1>
        <div class="sub">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: <span>Ø¨Ø¯Ø±ÙŠØ© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</span></div>
      </div>
    </div>
    <div class="right">
      <div class="pill">Ø§Ù„Ø²ÙˆØ§Ø±: <b id="visits">â€”</b></div>
      <div class="pill">Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„ØªØ§Ø±ÙŠØ®: <b id="todayTop">â€”</b></div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <section class="card" id="studentPanel">
      <div class="hd">
        <b>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</b>
        <span class="muted" id="today">â€”</span>
      </div>
      <div class="bd">
        <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ø© (Ø«Ù„Ø§Ø«ÙŠ)</label>
        <input id="studentName" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ"/>

        <label>Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³</label>
        <select id="lessonSelect"></select>

        <div class="row">
          <div>
            <label>Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="studentLink" readonly/>
          </div>
          <div>
            <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
            <input id="localState" readonly value="â€”"/>
          </div>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button class="btn good" id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø³</button>
          <button class="btn primary" id="saveBtn" disabled>Ø§Ø¹ØªÙ…Ø§Ø¯ + Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
          <button class="btn bad" id="clearBtn" disabled>Ù…Ø³Ø­ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³</button>
        </div>

        <div style="margin-top:12px" class="muted">
          âœ… ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø·Ø§Ù„Ø¨Ø©.<br/>
          âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Google Sheet.
        </div>
      </div>
    </section>

    <section class="card" id="lessonPanel">
      <div class="hd">
        <b id="lessonTitle">â€”</b>
        <span class="muted">Ø§Ù„Ù†Ù‚Ø§Ø·: <b id="pts">0</b> / <b id="maxPts">0</b></span>
      </div>
      <div class="bd">
        <div class="story" id="story">Ø§Ø®ØªØ§Ø±ÙŠ Ø¯Ø±Ø³Ù‹Ø§ Ø«Ù… Ø§Ø¶ØºØ·ÙŠ (Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø³).</div>
        <div id="questions"></div>
      </div>
    </section>
  </div>

  <footer>Â© Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø¨Ø¯Ø±ÙŠØ© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€“ Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</footer>
</div>

<div class="toast" id="toast"></div>
<canvas id="confetti"></canvas>

<div class="overlay" id="overlay">
  <div class="celebrate">
    <h2>ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø­ØµÙ„ØªÙ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ğŸ‰</h2>
    <p id="celebrateText">Ø£Ø­Ø³Ù†ØªÙâ€¦ ÙˆØ§ØµÙ„ÙŠ Ø§Ù„ØªØ£Ù„Ù‚ ğŸŒŸ</p>
    <button class="btn good" id="closeCelebrate">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<!-- âœ… Ù…Ù„Ù Ø§Ù„Ø¯Ø±ÙˆØ³ (ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù‚Øµ) -->
<script src="./lessons.js"></script>

<script>
/* âœ… Ø¶Ø¹ÙŠ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Apps Script Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ */
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbznaXBg9dlbwXDlCQIW9b6b-0Hnin9foReBdUpkPFHjjGbz_5gk24WQmG8SgtulF8Oh/exec";
const SITE_KEY = "READING_SCIENCE_G6";

/* âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³ ØªÙØ­Ù…Ù‘Ù„ Ù…Ù† lessons.js */
const LESSONS = (window.LESSONS || []);

const $ = s => document.querySelector(s);
function toast(msg){
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>t.classList.remove("show"), 2400);
}

/* Ø¥Ø±Ø³Ø§Ù„ POST */
function postJSON(obj){
  const payload = JSON.stringify(obj);
  if(navigator.sendBeacon){
    try{ navigator.sendBeacon(GAS_ENDPOINT, payload); return Promise.resolve(true); }catch(e){}
  }
  return fetch(GAS_ENDPOINT, {method:"POST", mode:"no-cors", body: payload})
    .then(()=>true).catch(()=>false);
}

/* JSONP Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (stats) */
function loadJSONP(params, callback){
  const cb = "cb_" + Math.random().toString(16).slice(2);
  window[cb] = (data)=>{ try{ callback(data); } finally{ delete window[cb]; script.remove(); } };
  params.callback = cb;
  const qs = new URLSearchParams(params).toString();
  const script = document.createElement("script");
  script.src = GAS_ENDPOINT + "?" + qs;
  document.body.appendChild(script);
}

/* Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ */
function keyProgress(student, lessonId){ return `G6_READ_${student}_${lessonId}`; }
function saveProgress(student, lessonId, answers){ localStorage.setItem(keyProgress(student, lessonId), JSON.stringify(answers)); }
function loadProgress(student, lessonId){ try{ return JSON.parse(localStorage.getItem(keyProgress(student, lessonId)) || "null"); } catch{ return null; } }
function clearProgress(student, lessonId){ localStorage.removeItem(keyProgress(student, lessonId)); }

/* Ø¬Ø±Ø³ Ø§Ù„Ø®Ø·Ø£ */
function playErrorBeep(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type="square"; o.frequency.value=220; g.gain.value=0.06;
    o.connect(g); g.connect(ctx.destination);
    o.start(); setTimeout(()=>{o.stop(); ctx.close();}, 160);
  }catch(e){}
}

/* Ø§Ø­ØªÙØ§Ù„ */
$("#closeCelebrate").addEventListener("click", ()=>{
  $("#overlay").classList.remove("show");
  stopConfetti();
});
let confettiAnim=null;
function startConfetti(){
  const c=$("#confetti"); c.classList.add("show");
  const ctx=c.getContext("2d");
  const resize=()=>{ c.width=innerWidth; c.height=innerHeight; };
  resize(); window.addEventListener("resize", resize);

  const parts = Array.from({length:160}, ()=>({
    x: Math.random()*c.width,
    y: Math.random()*-c.height,
    vy: 2+Math.random()*4,
    vx: -1+Math.random()*2,
    r: 2+Math.random()*4,
    a: Math.random()*Math.PI*2
  }));

  const draw=()=>{
    ctx.clearRect(0,0,c.width,c.height);
    parts.forEach(p=>{
      p.x += p.vx; p.y += p.vy; p.a += 0.08;
      if(p.y > c.height+20){ p.y = -20; p.x = Math.random()*c.width; }
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.a);
      ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
      ctx.restore();
    });
    confettiAnim=requestAnimationFrame(draw);
  };
  draw();
}
function stopConfetti(){
  const c=$("#confetti");
  c.classList.remove("show");
  if(confettiAnim) cancelAnimationFrame(confettiAnim);
  confettiAnim=null;
}
function celebrate(student, lessonTitle){
  $("#celebrateText").textContent = `ğŸ‘ Ø£Ø­Ø³Ù†ØªÙ ÙŠØ§ ${student}! Ø£ÙƒÙ…Ù„ØªÙ Ø¯Ø±Ø³ (${lessonTitle}) Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©.`;
  $("#overlay").classList.add("show");
  startConfetti();
}

/* Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø³ */
const state = { lesson:null, answers:[], points:0 };

function fillLessons(){
  const sel = $("#lessonSelect");
  sel.innerHTML = "";
  LESSONS.forEach(L=>{
    const op = document.createElement("option");
    op.value = L.id; op.textContent = L.title;
    sel.appendChild(op);
  });
}

function updateStudentLink(){
  const name = $("#studentName").value.trim();
  const lessonId = $("#lessonSelect").value;
  const url = new URL(location.href);
  url.searchParams.set("student", name || "");
  url.searchParams.set("lesson", lessonId || "");
  $("#studentLink").value = url.toString();
  $("#localState").value = (name && lessonId && localStorage.getItem(keyProgress(name, lessonId))) ? "âœ… Ù…Ø­ÙÙˆØ¸" : "â€”";
}
$("#studentName").addEventListener("input", updateStudentLink);
$("#lessonSelect").addEventListener("change", updateStudentLink);

function renderLesson(student, lesson){
  state.lesson = lesson;
  state.answers = lesson.questions.map(()=>({selected:null, correct:false}));
  state.points = 0;

  $("#lessonTitle").textContent = lesson.title;
  $("#story").textContent = lesson.story;
  $("#maxPts").textContent = String(lesson.questions.length);
  $("#pts").textContent = "0";

  const saved = loadProgress(student, lesson.id);
  if(saved && Array.isArray(saved)){
    saved.forEach((sel, i)=>{
      if(typeof sel === "number"){
        state.answers[i].selected = sel;
        state.answers[i].correct = (sel === lesson.questions[i].a);
      }
    });
    state.points = state.answers.filter(a=>a.correct).length;
    $("#pts").textContent = String(state.points);
    $("#localState").value = "âœ… Ù…Ø­ÙÙˆØ¸";
  } else {
    $("#localState").value = "â€”";
  }

  const qs = $("#questions");
  qs.innerHTML = "";

  lesson.questions.forEach((qq, idx)=>{
    const box = document.createElement("div");
    box.className = "q";
    box.innerHTML = `<h3>${idx+1}) ${qq.q}</h3>`;
    const opts = document.createElement("div");

    qq.opts.forEach((txt, oi)=>{
      const opt = document.createElement("div");
      opt.className = "opt";
      opt.innerHTML = `<div class="bullet">${String.fromCharCode(65+oi)}</div><div>${txt}</div>`;

      if(state.answers[idx].selected === oi){
        opt.classList.add(oi === qq.a ? "good" : "bad");
      }

      opt.addEventListener("click", ()=>{
        Array.from(opts.children).forEach(ch=>ch.classList.remove("good","bad"));

        state.answers[idx].selected = oi;
        const ok = (oi === qq.a);
        state.answers[idx].correct = ok;
        opt.classList.add(ok ? "good" : "bad");

        state.points = state.answers.filter(a=>a.correct).length;
        $("#pts").textContent = String(state.points);

        saveProgress(student, lesson.id, state.answers.map(a=>a.selected));
        $("#saveBtn").disabled = false;
        $("#clearBtn").disabled = false;
        $("#localState").value = "âœ… Ù…Ø­ÙÙˆØ¸";

        if(!ok) playErrorBeep();
        toast(ok ? "âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©" : "ğŸ”” Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©.. Ø¹Ø¯Ù‘Ù„ÙŠÙ‡Ø§");
      });

      opts.appendChild(opt);
    });

    box.appendChild(opts);
    qs.appendChild(box);
  });

  $("#saveBtn").disabled = false;
  $("#clearBtn").disabled = false;
}

$("#startBtn").addEventListener("click", async ()=>{
  const student = $("#studentName").value.trim();
  if(student.length < 6){ toast("Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­."); return; }

  const lessonId = $("#lessonSelect").value;
  const lesson = LESSONS.find(l=>l.id===lessonId);
  renderLesson(student, lesson);

  const uid = (crypto?.randomUUID) ? crypto.randomUUID() : String(Date.now());

  await postJSON({
    action:"login",
    siteKey: SITE_KEY,
    uid,
    student,
    lessonId: lesson.id,
    lessonTitle: lesson.title,
    ua: navigator.userAgent
  });

  toast("ØªÙ… ÙØªØ­ Ø§Ù„Ø¯Ø±Ø³ âœ…");
});

$("#saveBtn").addEventListener("click", async ()=>{
  const student = $("#studentName").value.trim();
  if(!student || !state.lesson){ toast("Ø§Ø¨Ø¯Ø¦ÙŠ Ø§Ù„Ø¯Ø±Ø³ Ø£ÙˆÙ„Ø§Ù‹."); return; }

  const notAnswered = state.answers.some(a=>a.selected===null);
  if(notAnswered){ toast("Ø£Ø¬ÙŠØ¨ÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø«Ù… Ø§Ø¹ØªÙ…Ø¯ÙŠ."); return; }

  const ok = state.points;
  const max = state.lesson.questions.length;
  const bad = max - ok;
  const pct = Math.round((ok/max)*100);

  const uid = (crypto?.randomUUID) ? crypto.randomUUID() : String(Date.now());

  await postJSON({
    action:"result",
    siteKey: SITE_KEY,
    uid,
    student,
    lessonId: state.lesson.id,
    lessonTitle: state.lesson.title,
    ok, bad, pct
  });

  toast(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª âœ… (${pct}%)`);

  if(ok === max) celebrate(student, state.lesson.title);
});

$("#clearBtn").addEventListener("click", ()=>{
  const student = $("#studentName").value.trim();
  if(!student || !state.lesson) return;
  if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ù…Ø³Ø­ Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ")) return;
  clearProgress(student, state.lesson.id);
  toast("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø­ÙØ¸.");
  renderLesson(student, state.lesson);
});

function refreshVisits(){
  loadJSONP({action:"stats", siteKey: SITE_KEY}, (data)=>{
    if(data && data.ok) $("#visits").textContent = String(data.totalVisits ?? "â€”");
    else $("#visits").textContent = "â€”";
  });
}
refreshVisits();
postJSON({action:"visit", siteKey: SITE_KEY}).then(()=>setTimeout(refreshVisits, 700));

(function init(){
  if(!Array.isArray(LESSONS) || LESSONS.length===0){
    toast("âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¯Ø±ÙˆØ³ lessons.js");
    return;
  }

  fillLessons();

  const d = new Date();
  const top = d.toLocaleDateString("ar-SA",{weekday:"long",year:"numeric",month:"2-digit",day:"2-digit"});
  $("#todayTop").textContent = top;
  $("#today").textContent = top;

  const url = new URL(location.href);
  const s = url.searchParams.get("student") || "";
  const l = url.searchParams.get("lesson") || "";

  if(s) $("#studentName").value = s;
  if(l && LESSONS.some(x=>x.id===l)) $("#lessonSelect").value = l;

  updateStudentLink();

  if(s && l){
    const lesson = LESSONS.find(x=>x.id===l);
    renderLesson(s, lesson);
  }
})();
</script>
</body>
</html>
