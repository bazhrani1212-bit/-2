<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ â€“ Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</title>

<style>
body{
  font-family: "Cairo","Tajawal",sans-serif;
  margin:0;
  background:#ffffff;
  color:#111;
}
header{
  border-bottom:1px solid #e5e7eb;
  padding:16px;
  text-align:center;
}
header h1{margin:0;font-size:20px}
header p{margin:6px 0 0;font-weight:bold;color:#2563eb}

.container{
  max-width:1000px;
  margin:20px auto;
  padding:16px;
}
.card{
  border:1px solid #e5e7eb;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}
label{display:block;margin-top:10px;font-size:14px}
input,select{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
}
button{
  margin-top:12px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid #ccc;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}
button.secondary{
  background:#f3f4f6;
  color:#111;
}
.story{
  background:#f9fafb;
  border:1px dashed #cbd5e1;
  padding:14px;
  margin-top:10px;
  line-height:1.9;
}
.question{
  margin-top:14px;
}
.option{
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:10px;
  margin-top:6px;
  cursor:pointer;
}
.option.correct{
  background:#dcfce7;
  border-color:#16a34a;
}
.option.wrong{
  background:#fee2e2;
  border-color:#dc2626;
}
footer{
  text-align:center;
  margin:20px;
  font-size:13px;
  color:#666;
}
.badge{
  display:inline-block;
  margin:4px;
  padding:6px 10px;
  border-radius:999px;
  background:#f1f5f9;
  font-size:13px;
}
</style>
</head>

<body>

<header>
  <h1>Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</h1>
  <p>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: Ø¨Ø¯Ø±ÙŠØ© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</p>
  <div class="badge">Ø§Ù„Ø²ÙˆØ§Ø±: <b id="visits">â€”</b></div>
  <div class="badge">Ø§Ù„ØªØ§Ø±ÙŠØ®: <b id="today">â€”</b></div>
</header>

<div class="container">

<div class="card">
  <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</label>
  <input id="student" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ"/>

  <label>Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø¯Ø±Ø³</label>
  <select id="lessonSelect"></select>

  <button onclick="openLesson()">ÙØªØ­ Ø§Ù„Ø¯Ø±Ø³</button>
</div>

<div class="card" id="lessonBox" style="display:none">
  <h3 id="lessonTitle"></h3>
  <div class="story" id="lessonStory"></div>
  <div id="questions"></div>
  <button onclick="submitResult()">Ø§Ø¹ØªÙ…Ø§Ø¯ + Ø­ÙØ¸</button>
</div>

</div>

<footer>
Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€“ Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° Ø£/ Ø¨Ø¯Ø±ÙŠØ© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ
</footer>

<!-- ğŸ”¹ Ù…Ù„Ù Ø§Ù„Ø¯Ø±ÙˆØ³ -->
<script src="./lessons.js?v=FINAL-2026-01-NEW"></script>

<script>
/* ============================= */
/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ â€“ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
/* ============================= */
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbwv6VxqnyAZDfx1znbT-7jScudAnPmyOXREssjWtTDblvQGu8lgFUtoR5bsikBfFGF_/exec";
const SITE_KEY = "READING_SCIENCE_G6";

/* ============================= */
const LESSONS = window.LESSONS || [];
const answers = {};
let currentLesson = null;

/* Ø§Ù„ØªØ§Ø±ÙŠØ® */
document.getElementById("today").textContent =
  new Date().toLocaleDateString("ar-SA");

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³ */
const sel = document.getElementById("lessonSelect");
LESSONS.forEach(l=>{
  const o=document.createElement("option");
  o.value=l.id;
  o.textContent=l.title;
  sel.appendChild(o);
});

/* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± */
function loadJSONP(params, callback){
  const cb="cb_"+Math.random().toString(16).slice(2);
  window[cb]=(data)=>{callback(data);delete window[cb];};
  params.callback=cb;
  const s=document.createElement("script");
  s.src=GAS_ENDPOINT+"?"+new URLSearchParams(params).toString();
  document.body.appendChild(s);
}
loadJSONP({action:"stats",siteKey:SITE_KEY},d=>{
  if(d && d.ok) document.getElementById("visits").textContent=d.totalVisits;
});
navigator.sendBeacon(GAS_ENDPOINT,JSON.stringify({action:"visit",siteKey:SITE_KEY}));

/* ÙØªØ­ Ø§Ù„Ø¯Ø±Ø³ */
function openLesson(){
  const student=document.getElementById("student").value.trim();
  if(!student){alert("Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø©");return;}

  currentLesson=LESSONS.find(l=>l.id===sel.value);
  document.getElementById("lessonTitle").textContent=currentLesson.title;
  document.getElementById("lessonStory").textContent=currentLesson.story;

  const qBox=document.getElementById("questions");
  qBox.innerHTML="";
  answers[currentLesson.id]=[];

  currentLesson.questions.forEach((q,i)=>{
    const d=document.createElement("div");
    d.className="question";
    d.innerHTML="<b>"+(i+1)+") "+q.q+"</b>";
    q.opts.forEach((op,idx)=>{
      const o=document.createElement("div");
      o.className="option";
      o.textContent=op;
      o.onclick=()=>{
        answers[currentLesson.id][i]=idx;
        [...d.querySelectorAll(".option")].forEach(x=>x.classList.remove("correct","wrong"));
        if(idx===q.a) o.classList.add("correct");
        else o.classList.add("wrong");
      };
      d.appendChild(o);
    });
    qBox.appendChild(d);
  });

  document.getElementById("lessonBox").style.display="block";

  navigator.sendBeacon(GAS_ENDPOINT,JSON.stringify({
    action:"login",
    siteKey:SITE_KEY,
    student:student,
    lessonId:currentLesson.id,
    lessonTitle:currentLesson.title,
    ua:navigator.userAgent
  }));
}

/* Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© */
function submitResult(){
  const student=document.getElementById("student").value.trim();
  const a=answers[currentLesson.id]||[];
  let ok=0;
  currentLesson.questions.forEach((q,i)=>{
    if(a[i]===q.a) ok++;
  });
  const bad=currentLesson.questions.length-ok;
  const pct=Math.round(ok/currentLesson.questions.length*100);

  navigator.sendBeacon(GAS_ENDPOINT,JSON.stringify({
    action:"result",
    siteKey:SITE_KEY,
    student:student,
    lessonId:currentLesson.id,
    lessonTitle:currentLesson.title,
    ok:ok,
    bad:bad,
    pct:pct,
    points:ok,
    maxPoints:currentLesson.questions.length
  }));

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ”ï¸");
}
</script>

</body>
</html>
